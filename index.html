<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Good Deal</title>
<link rel="stylesheet" href="css/style.css" />

<style>
body {
	margin: 0;
	padding: 0;
	font-family: "Microsoft JhengHei", sans-serif;
	background: #ffffff;
	color: #333;
}

/* å°è¦½åˆ— */
nav {
	width: 100%;
	background: #fff;
	border-bottom: 1px solid #eee;
	position: sticky;
	top: 0;
	z-index: 100;
}

.nav-container {
	max-width: 1100px;
	margin: auto;
	padding: 12px 20px;
	display: flex;
	justify-content: space-between;
	align-items: center;
}

.logo {
	font-size: 22px;
	font-weight: bold;
}

.nav-links {
	display: flex;
	gap: 24px;
	list-style: none;
	margin: 0;
	padding: 0;
}

.nav-links a {
	text-decoration: none;
	color: #333;
	font-size: 16px;
}

/* æ‰‹æ©Ÿé¸å–® */
.hamburger {
	display: none;
	font-size: 26px;
	cursor: pointer;
}

@media ( max-width : 768px) {
	.nav-links {
		display: none;
		flex-direction: column;
		background: #fff;
		position: absolute;
		top: 60px;
		right: 20px;
		width: 160px;
		border: 1px solid #eee;
		border-radius: 10px;
		padding: 10px;
	}
	.nav-links.active {
		display: flex;
	}
	.hamburger {
		display: block;
	}
}

/* Hero å€ */
.hero {
	text-align: center;
	padding: 40px 20px;
	background: #f7f7f7;
}

.hero h1 {
	font-size: 32px;
	margin-bottom: 10px;
}

.hero p {
	font-size: 16px;
	color: #666;
	margin-bottom: 20px;
}

.search-box {
	margin: 0 auto;
	margin-top: 20px;
	display: flex;
	gap: 10px;
	max-width: 480px;
	padding: 0 20px;
}

.search-box input {
	flex: 1;
	padding: 14px;
	border: 1px solid #ccc;
	border-radius: 10px;
	font-size: 16px;
}

.search-box button {
	padding: 14px 20px;
	border: none;
	background: black;
	color: white;
	border-radius: 10px;
	cursor: pointer;
	font-size: 16px;
	transition: 0.2s;
}

.search-box button:hover {
	background: #333;
}

.category-tags {
	display: flex;
	flex-wrap: wrap;
	gap: 10px;
}

.category-tag {
	padding: 8px 14px;
	background: #f2f2f2;
	border-radius: 20px;
	cursor: pointer;
	font-size: 15px;
	transition: 0.2s;
}

.category-tag:hover {
	background: #ddd;
}

/* åŠŸèƒ½å€ */
.features {
	display: grid;
	grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
	gap: 20px;
	padding: 40px 20px;
	max-width: 1000px;
	margin: auto;
}

.card {
	background: white;
	padding: 20px;
	border-radius: 14px;
	box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
	text-align: center;
}

.store-card-container {
	display: grid;
	grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
	gap: 20px;
}

.store-card {
	border-radius: 18px;
	overflow: hidden;
	box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
	cursor: pointer;
	transition: .25s;
	background: white;
}

.store-card:hover {
	transform: translateY(-5px);
	box-shadow: 0 6px 18px rgba(0, 0, 0, 0.2);
}

/* ä¸ŠåŠéƒ¨èƒŒæ™¯ï¼ˆå“ç‰Œ Logo å¡«æ»¿ï¼‰ */
.store-card-top {
	height: 120px;
	background-size: cover;
	background-position: center;
	/*position: relative;*/
}

/* åŠ ä¸Šæ·¡åŒ–é®ç½©è®“æ–‡å­—æ›´æ¸…æ¥š
.store-card-top::after {
    content: "";
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.25);
    backdrop-filter: blur(2px);
}
*/

/* ä¸‹åŠéƒ¨ï¼šå“ç‰Œåç¨± */
.store-card-bottom {
	padding: 12px;
	font-size: 16px;
	font-weight: bold;
	text-align: center;
}

/* ç†±é–€æ¨è–¦ */
.section-title {
	text-align: center;
	font-size: 24px;
	margin-top: 30px;
	font-weight: bold;
}

.hot-items {
	display: grid;
	grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
	gap: 20px;
	padding: 20px;
	max-width: 1000px;
	margin: auto;
}

.hot-items .item img {
	width: 140px; /* å›ºå®šå¯¬åº¦ */
	height: 140px; /* å›ºå®šé«˜åº¦ */
	object-fit: cover; /* ä¿æŒæ¯”ä¾‹è£åˆ‡ */
	border-radius: 10px; /* å¯åŠ å¯ä¸åŠ  */
	display: block;
	margin: 0 auto;
}

.hot-items .item {
	text-align: center;
}

/* Footer */
footer {
	text-align: center;
	padding: 20px;
	margin-top: 40px;
	font-size: 14px;
	color: #777;
	border-top: 1px solid #eee;
}
</style>
</head>

<body>

	<!-- å°è¦½åˆ— -->
	<nav>
		<div class="nav-container">
			<div class="logo">Good Deal</div>

			<div class="hamburger" onclick="toggleMenu()">â˜°</div>

			<ul class="nav-links" id="navMenu">
				<li><a href="index.html">é¦–é </a></li>
				<li><a href="#hot">ç†±é–€å•†å“</a></li>
				<li><a href="#fav">æˆ‘çš„æ”¶è—</a></li>
				<li><a href="#login">ç™»å…¥</a></li>
			</ul>
		</div>
	</nav>

	<section class="hero">
		<h1>å¿«é€Ÿæ‰¾åˆ°æœ€ä¾¿å®œçš„å•†å“åƒ¹æ ¼</h1>
		<p>æ•´åˆå…¨å°ä¸»è¦é‡è²©åº—ï¼Œæ¯æ—¥æ›´æ–°åƒ¹æ ¼è³‡è¨Šï¼Œå¹«ä½ çœæ™‚åˆçœéŒ¢ã€‚</p>

		<div class="search-box">
			<input id="keyword" type="text" placeholder="è¼¸å…¥å•†å“åç¨±">
			<button onclick="openScanner()">ğŸ“· æƒç¢¼</button>
			<button onclick="goSearch()">æœå°‹</button>
		</div>
	</section>

	<div id="scanner" style="display: none; padding: 20px;">
		<div id="qr-reader" style="width: 300px; margin: auto;"></div>
		<button onclick="closeScanner()">é—œé–‰</button>
	</div>


	<section class="features">
		<div class="card">
			<h3>ğŸ” å³æ™‚æœå°‹</h3>
			<p>å¿«é€ŸæŸ¥è©¢å•†å“åƒ¹æ ¼è³‡è¨Šã€‚</p>
		</div>

		<div class="card">
			<h3>ğŸ“Š åƒ¹æ ¼æ¯”è¼ƒ</h3>
			<p>è‡ªå‹•æ¯”å°å„å¹³å°åƒ¹æ ¼ã€‚</p>
		</div>

		<div class="card">
			<h3>â­ æ”¶è—å•†å“</h3>
			<p>è¿½è¹¤åƒ¹æ ¼è®ŠåŒ–ï¼Œä¸éŒ¯éé™åƒ¹æ™‚æ©Ÿã€‚</p>
		</div>
	</section>

	<h2 class="section-title">ğŸ¬ åº—å®¶æœå°‹</h2>
	<section style="padding: 20px; max-width: 1100px; margin: auto;">
		<div id="store-cards" class="store-card-container"></div>
	</section>


	<!-- åˆ†é¡æ¨™ç±¤å€ -->
	<h2 class="section-title">ğŸ¬ åˆ†é¡æœå°‹</h2>
	<section style="padding: 20px; max-width: 1100px; margin: auto;">
		<div id="category-tags" class="category-tags"></div>
	</section>

	<h2 class="section-title" id="hot">ğŸ”¥ ç†±é–€å•†å“</h2>
	<section class="hot-items">
		<div class="item">
			<img src="assets/placeholder.png" alt="å•†å“1">
			<p>å¯å£å¯æ¨‚ 2L</p>
		</div>
		<div class="item">
			<img src="assets/placeholder.png" alt="å•†å“2">
			<p>çµ±ä¸€å¸ƒä¸ 6å…¥</p>
		</div>
		<div class="item">
			<img src="assets/placeholder.png" alt="å•†å“3">
			<p>è¡›ç”Ÿç´™ å®¶åº­è™Ÿ</p>
		</div>
	</section>

	<footer> Â© 2025 å•†å“æ¯”åƒ¹å¹³å° GoodDeal </footer>

	<script>
async function loadCategories() {
    const res = await fetch("/api/categories");
    const categories = await res.json();

    const container = document.getElementById("category-tags");
    container.innerHTML = "";

    // å»ºç«‹åˆ†é¡æ¨™ç±¤ï¼ˆä¾†è‡ªè³‡æ–™åº«ï¼‰
    categories.forEach(cat => {
        const tag = document.createElement("div");
        tag.className = "category-tag";
        tag.dataset.id = cat.categoryId;        // â† æ­£ç¢º
        tag.innerText = cat.categoryName;       // â† æ­£ç¢º
        tag.onclick = () => selectCategory(cat.categoryId);
        container.appendChild(tag);
    });
}

function selectCategory(id) {
    // æ¨™ç±¤åˆ‡æ›æ¨£å¼
    document.querySelectorAll(".category-tag").forEach(t => t.classList.remove("active"));
    document.querySelector(`.category-tag[data-id="${id}"]`).classList.add("active");

    const keyword = document.getElementById("keyword").value;

    window.location.href = `search.html?q=${keyword}&cat=${id}`;
}

function goSearch() {
    const key = document.getElementById("keyword").value;
    const selected = document.querySelector(".category-tag.active")?.dataset.id || "";

    window.location.href = `search.html?q=${key}&cat=${selected}`;
}

function toggleMenu() {
    document.getElementById("navMenu").classList.toggle("active");
}

loadCategories();

const stores = [
    {
        id: 1,
        name: "å…¨è¯ç¦åˆ©ä¸­å¿ƒ",
        logo: "assets/stores/px.png"
    },
    {
        id: 2,
        name: "å®¶æ¨‚ç¦",
        logo: "assets/stores/carrefour.png"
    },
    {
        id: 3,
        name: "å¤§æ½¤ç™¼",
        logo: "assets/stores/rt.png"
    }
];

function loadStores() {
    const container = document.getElementById("store-cards");
    container.innerHTML = "";

    stores.forEach(store => {
        const card = document.createElement("div");
        card.className = "store-card";
        card.onclick = () => goStore(store.id);

        card.innerHTML = `
            <div class="store-card-top"
                 style="background-image:url('${store.logo}')">
            </div>
            <div class="store-card-bottom">${store.name}</div>
        `;

        container.appendChild(card);
    });
}

function goStore(storeId) {
    // è·³åˆ°è©²åº—å®¶å•†å“æœå°‹
    window.location.href = `search.html?store=${storeId}`;
}

// åˆå§‹åŒ–
loadStores();

//æƒç¢¼è¦–çª—é–‹å•Ÿ
async function openScanner() {
  const scannerEl = document.getElementById("barcode-scanner");
  scannerEl.style.display = "flex";

  // å»ºç«‹æƒæå™¨
  const html5QrCode = new Html5Qrcode("qr-reader");

  // ä½¿ç”¨å¾Œé¡é ­ï¼ˆfacingMode: environmentï¼‰æƒæ
  html5QrCode.start(
    { facingMode: "environment" },
    { fps: 10, qrbox: 250 },   // å¯èª¿æ•´ fps æˆ– qrbox å°ºå¯¸
    (decodedText, decodedResult) => {
      // æƒåˆ°å­—ä¸²å¾Œï¼Œå°‡æ¢ç¢¼æ”¾å…¥æœå°‹æ¡†ï¼Œä¸¦ç«‹å³åœæ­¢æƒæèˆ‡é—œé–‰è¦–çª—
      document.getElementById("keyword").value = decodedText;

      html5QrCode.stop().then(() => {
        // åœæ­¢ç›¸æ©Ÿ
        scannerEl.style.display = "none";
        goSearch();  // ç›´æ¥è·³è½‰åˆ°æœå°‹é 
      }).catch(err => {
        console.warn("åœæ­¢æƒæå¤±æ•—:", err);
        scannerEl.style.display = "none";
      });
    },
    errorMessage => {
      // å¯ä»¥åœ¨é€™è£¡é¡¯ç¤ºæƒæéç¨‹ä¸­çš„éŒ¯èª¤æˆ–æç¤ºï¼Œä½†é€šå¸¸å¯å¿½ç•¥
      // console.log("æƒæä¸­éŒ¯èª¤: ", errorMessage);
    }
  ).catch(err => {
    console.error("ç›¸æ©Ÿå•Ÿå‹•å¤±æ•—:", err);
    alert("ç„¡æ³•å•Ÿå‹•ç›¸æ©Ÿæƒæï¼Œè«‹ç¢ºèªæ˜¯å¦å…è¨±ä½¿ç”¨ç›¸æ©Ÿã€‚");
    scannerEl.style.display = "none";
  });
}

// é—œé–‰æƒæè¦–çª—
function closeScanner() {
  // é‡æ–°è¼‰å…¥æˆ–å¼·åˆ¶é—œé–‰è¦–çª—å³å¯ï¼Œé€™è£¡é¸æ“‡é‡æ–°è¼‰å…¥æ•´é ç°¡å–®è™•ç†
  location.reload();
}
</script>
	<!-- æ¢ç¢¼æƒæè¦–çª—ï¼Œé è¨­éš±è— -->
	<div id="barcode-scanner"
		style="display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.6); z-index: 9999; align-items: center; justify-content: center;">
		<div
			style="position: relative; width: 100%; max-width: 360px; margin: auto; padding: 20px; background: #fff; border-radius: 12px; text-align: center;">
			<div id="qr-reader" style="width: 100%;"></div>
			<button onclick="closeScanner()"
				style="margin-top: 12px; padding: 8px 16px; border: none; background: #333; color: #fff; border-radius: 8px;">é—œé–‰</button>
		</div>
	</div>

	<!-- å¼•å…¥æ¢ç¢¼æƒæåº« -->
	<script src="https://unpkg.com/html5-qrcode"></script>
</body>
</html>